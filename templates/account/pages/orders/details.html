<section class="account-wrapper">
  {{> account/components/navigation account_page='orders'}}

  <div class="account-body">

    <h1 class="account-heading">{{lang 'account.orders.details.heading' number=order.id}}</h1>

    <div class="account-order-details">
      <div class="account-order-details-date">{{lang 'account.orders.list.order_date'}}: {{order.date}}</div>
      <div class="account-order-details-status">{{lang 'account.orders.list.order_status'}}: {{order.status_text}}</div>
    </div>

    <h2 class="account-sub-heading">{{lang 'account.orders.details.summary'}}</h2>
    <div class="account-order-info">
      {{#if customer.shipping_address.length}}
        <section class="account-order-info-shipping">
          <p class="account-order-details-label">{{lang 'account.orders.details.ship_to'}}</p>
          <ul class="order-address">
            <li class="order-address-item">
              <span class="order-address-item-content">{{order.shipping_address.full_name}}</span>
            </li>
            <li class="order-address-item">
              <span class="order-address-item-content">{{order.shipping_address.company}}</span>
            </li>
            <li class="order-address-item">
              <span class="order-address-item-content">{{order.shipping_address.address_lines.[0]}}</span>
            </li>
            <li class="order-address-item">
              <span class="order-address-item-content">{{order.shipping_address.address_lines.[1]}}</span>
            </li>
            <li class="order-address-item">
              <span class="order-address-item-content">{{order.shipping_address.city}}</span>
              <span class="order-address-item-content">{{order.shipping_address.state}}</span>
              <span class="order-address-item-content">&nbsp;{{order.shipping_address.zip}}</span>
            </li>
            <li class="order-address-item">
              <span class="order-address-item-content">{{order.shipping_address.country}}</span>
            </li>
          </ul>
        </section>
      {{/if}}

      <section class="account-order-info-billing">
        {{#if customer.shipping_address.length}}
          <p class="account-order-details-label">{{lang 'account.orders.details.bill_to'}}</p>
        {{else}}
          <p class="account-order-details-label">{{lang 'account.orders.details.ship_bill_to'}}</p>
        {{/if}}

        <ul class="order-address">
          <li class="order-address-item">
            <span class="order-address-item-content">{{order.billing_address.full_name}}</span>
          </li>
          <li class="order-address-item">
            <span class="order-address-item-content">{{order.billing_address.company}}</span>
          </li>
          <li class="order-address-item">
            <span class="order-address-item-content">{{order.billing_address.address_lines.[0]}}</span>
          </li>
          <li class="order-address-item">
            <span class="order-address-item-content">{{order.billing_address.address_lines.[1]}}</span>
          </li>
          <li class="order-address-item">
            <span class="order-address-item-content">{{order.billing_address.city}},</span>
            <span class="order-address-item-content">{{order.billing_address.state}}</span>
            <span class="order-address-item-content">{{order.billing_address.zip}}</span>
          </li>
          <li class="order-address-item">
            <span class="order-address-item-content">{{order.billing_address.country}}</span>
          </li>
        </ul>
      </section>

      <section class="account-order-info-payment">
        <p class="account-order-details-label">{{lang 'account.orders.details.payment_details'}}</p>
        <ul class="order-address">
          <li class="order-address-item">
            <span class="order-payment-description">{{lang 'account.orders.details.order_total'}}</span>
            <span class="order-payment-value">{{order.total.formatted}}</span>
          </li>
          <li class="order-address-item">
            <span class="order-payment-description">{{lang 'account.orders.details.payment_date'}}</span>
            <span class="order-payment-value">{{order.date}}</span>
          </li>
          <li class="order-address-item">
            <span class="order-payment-description">{{lang 'account.orders.details.payment_method'}}</span>
            {{#compare order.payment_method 'storecredit' operator='==='}}
              <span class="order-payment-value">{{lang 'account.orders.details.store_credit'}}</span>
            {{else}}
              <span class="order-payment-value">{{order.payment_method}} ending in {{order.card_number_last_four}}</span>
            {{/compare}}
          </li>
        </ul>
        
        <a class="account-order-invoice button button-small" href="{{order.invoice_url}}">
          {{lang 'account.orders.details.print_invoice'}}
        </a>

        <!-- TODO: Make sure BC has fixed the reorder_url linking issue -->
        <a class="account-order-invoice button button-small" href="{{order.reorder_url}}">
          {{lang 'account.orders.details.reorder'}}
        </a>
      </section>

      <!-- TODO: Test with real shipments -->
      {{#if shipments}}
        <section class="account-order-info-shipments">
          <h2 class="account-sub-heading">{{lang 'account.orders.details.shipments.title'}}</h2>

          <ul class="account-list account-shipments">

            <li class="account-list-header">

              <div class="account-list-header-item">
                <span class="account-list-header-label">{{lang 'account.orders.details.shipments.date'}}</span>
              </div>

              <div class="account-list-header-item">
                <span class="account-list-header-label">{{lang 'account.orders.details.shipments.method'}}</span>
              </div>

              <div class="account-list-header-item">
                <span class="account-list-header-label">{{lang 'account.orders.details.shipments.link'}}</span>
              </div>

            </li>

          </ul>

          {{#each shipments}}
            <li class="account-list-item">
              <div class="account-list-item-details">
                <div class="account-list-item-cell">{{date_shipped}}</div>
                <div class="account-list-item-cell">{{shipping_provider}}</div>
                <div class="account-list-item-cell">
                  {{#if shipping_track.url}}
                    <a href="{{shipping_track.url}}">
                  {{/if}}

                  {{#if show_shipping_method}}
                    {{shipping_track.number}} &mdash; {{shipping_method}}
                  {{else}}
                    {{shipping_track.number}}
                  {{/if}}

                  {{#if shipping_track.url}}
                    </a>
                  {{/if}}
                </div>
              </div>
            </li>
          {{/each}}

        </section>
      {{/if}}

      {{#if order.comments}}
        <section class="account-order-info-comments">
          <h2 class="account-sub-heading">{{lang 'account.orders.details.comments'}}</h2>
          <p class="order-details-info">
            {{order.comments}}
          </p>
        </section>
      {{/if}}

      {{> account/components/order-contents order}}
    </div>
  </div>

</section>
